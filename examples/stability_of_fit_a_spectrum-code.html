<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.3 on Thu Feb 18 10:28:42 2021 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>stability_of_fit_a_spectrum.pro (AmesPAHdbIDLSuite Manual)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="stability_of_fit_a_spectrum.pro (AmesPAHdbIDLSuite Manual)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="container">
      <div class="content">
	<code class="source"><span class="comments">; docformat = 'rst'</span>

<span class="comments">;+</span>
<span class="comments">;</span>
<span class="comments">; This is an example of testing the stability of fitting an</span>
<span class="comments">; astronomical spectrum by iteratively removing the most contributing</span>
<span class="comments">; PAH species from a subsequent fit, built around the functionality</span>
<span class="comments">; provided by the AmesPAHdbIDLSuite and should help confirm that the</span>
<span class="comments">; it has been properly installed. The source code is annotated to</span>
<span class="comments">; guide users and developers in the inner workings of the suite.</span>
<span class="comments">;</span>
<span class="comments">; Updated versions of the NASA Ames PAH IR Spectroscopic Database and</span>
<span class="comments">; more information can be found at: `www.astrochemistry.org/pahdb &lt;https://www.astrochemistry.org/pahdb>`.</span>
<span class="comments">;</span>
<span class="comments">; :Examples:</span>
<span class="comments">;   Call the procedure directly::</span>
<span class="comments">;</span>
<span class="comments">;     IDL> stability_of_fit_a_spectrum</span>
<span class="comments">;</span>
<span class="comments">; :Author:</span>
<span class="comments">;   Dr. Christiaan Boersma</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;   BSD licensed</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;   Changes::</span>
<span class="comments">;</span>
<span class="comments">;     08-19-2019</span>
<span class="comments">;     Documentation added. Christiaan Boersma.</span>
<span class="comments">;-</span>

<span class="comments">;+</span>
<span class="comments">; Procedure testing the stability of a spectroscopic fit.</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;   Example</span>
<span class="comments">;-</span>
PRO STABILITY_OF_FIT_A_SPECTRUM

  <span class="comments">; the Spitzer IRS/SL 10 - 15 micron spectrum of NGC7023</span>
  file = 'ngc7023.dat'

  <span class="comments">; read observations into AmesPAHdbIDLSuite_Observation</span>
  observation = OBJ_NEW('AmesPAHdbIDLSuite_Observation', $
                        file, $
                        Units=AmesPAHdbIDLSuite_CREATE_OBSERVATION_UNITS_S(AUNIT=3, OUNIT=1))

  <span class="comments">; turn wavelength into frequency</span>
  observation->AbscissaUnitsTo,1

  <span class="comments">; rebin to uniform frequency grid</span>
  observation->Rebin,5D,/Uniform

  <span class="comments">; read in the default database defined by the environement variable</span>
  <span class="comments">; !AMESPAHDEFAULTDB or the system variable AMESPAHDEFAULTDB. use the</span>
  <span class="comments">; keyword FILENAME if these have not been set</span>
  pahdb = OBJ_NEW('AmesPAHdbIDLSuite')

  <span class="comments">; retrieve all the transitions from the database</span>
  transitions = pahdb->getTransitionsByUID( -1 )

  <span class="comments">; have every PAH absorb 6 eV (CGS units) and include the temperature</span>
  <span class="comments">; cascade</span>
  transitions->Cascade,6D * 1.6021765D-12

  <span class="comments">; shift data 15 wavenumber to the red</span>
  transitions->Shift,-15D

  <span class="comments">; convolve the transitions into a spectrum</span>
  spectrum = transitions->Convolve( $
             Grid=observation->getGrid(), $
             FWHM=15D, $
             /Gaussian)

  OBJ_DESTROY,transitions

  <span class="comments">; run stability test</span>
  niterations = 11

  data = REPLICATE({norm: 0D, $
                    anion: 0D, $
                    neutral: 0D, $
                    cation:0D, $
                    small:0D, $
                    large:0D, $
                    pure:0D, $
                    nitrogen: 0D,$
                    solo: 0L, $
                    duo: 0L, $
                    trio: 0L, $
                    quartet: 0L, $
                    quintet: 0L}, niterations)

  FOR i = 0, niterations - 1 DO BEGIN

    <span class="comments">; fit the spectrum</span>
    fit = spectrum->Fit(observation)

    <span class="comments">; store breakdown</span>

    d = data[i]

    STRUCT_ASSIGN,fit->getBreakdown(), d

    data[i] = d

    data[i].norm = fit->getNorm()

    <span class="comments">; sort the spectra based on their total contribution to the flux</span>
    fit->Sort,/Flux

    <span class="comments">; remove most contributing species from spectrum</span>
    spectrum->Intersect,(fit->getUids())[1:*]

    <span class="comments">; clean up fit</span>
    OBJ_DESTROY,fit

  ENDFOR

  PRINT

  <span class="comments">; clean up</span>
  OBJ_DESTROY,[spectrum, pahdb]

  <span class="comments">; plot ionized fraction</span>
  PLOT,INDGEN(niterations), data.cation / (data.cation + data.neutral),XTITLE='iteration [#] / species removed [#]',YTITLE='ionized fraction [ratio]',YRANGE=[0,1],/YSTYLE

  key = ''
  IF !D.NAME EQ 'X' THEN READ,key,PROMPT="Press &lt;enter> to continue..."

  <span class="comments">; plot large fraction</span>
  PLOT,INDGEN(niterations), data.large / (data.large + data.small),XTITLE='iteration [#] / species removed [#]',YTITLE='large fraction [ratio]',YRANGE=[0,1],/YSTYLE

  IF !D.NAME EQ 'X' THEN READ,key,PROMPT="Press &lt;enter> to continue..."

  <span class="comments">; plot nitrogen fraction</span>
  PLOT,INDGEN(niterations), data.nitrogen / (data.nitrogen + data.pure),XTITLE='iteration [#] / species removed [#]',YTITLE='nitrogen fraction [ratio]',YRANGE=[0,1],/YSTYLE

  IF !D.NAME EQ 'X' THEN READ,key,PROMPT="Press &lt;enter> to continue..."

  <span class="comments">; plot solo/(duo+trio)</span>
  PLOT,INDGEN(niterations), data.solo / (data.duo + data.trio),XTITLE='iteration [#] / species removed [#]',YTITLE='solo/duo+trio [ratio]',YRANGE=[0,1],/YSTYLE

END
</code>
      </div>
    </div>
  </body>
</html>