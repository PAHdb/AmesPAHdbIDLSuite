<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.3 on Thu Apr 28 09:47:08 2022 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>random_mixtures.pro (AmesPAHdbIDLSuite Manual)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="random_mixtures.pro (AmesPAHdbIDLSuite Manual)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="container">
      <div class="content">
	<code class="source"><span class="comments">; docformat = 'rst'</span>

<span class="comments">;+</span>
<span class="comments">;</span>
<span class="comments">; This is an example of preducing a number of random-mixture PAH</span>
<span class="comments">; emission spectrum, built around the functionality provided by the</span>
<span class="comments">; AmesPAHdbIDLSuite and should help confirm that the it has been</span>
<span class="comments">; properly installed.</span>
<span class="comments">;</span>
<span class="comments">; Updated versions of the NASA Ames PAH IR Spectroscopic Database and</span>
<span class="comments">; more information can be found at: `www.astrochemistry.org/pahdb &lt;https://www.astrochemistry.org/pahdb>`.</span>
<span class="comments">;</span>
<span class="comments">; :Examples:</span>
<span class="comments">;   Call the procedure directly::</span>
<span class="comments">;</span>
<span class="comments">;     IDL> random_mixtures</span>
<span class="comments">;</span>
<span class="comments">; :Author:</span>
<span class="comments">;   Dr. Christiaan Boersma</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;   BSD licensed</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;   Changes::</span>
<span class="comments">;</span>
<span class="comments">;     07-06-2021</span>
<span class="comments">;     Cleaned up progress bar. Christiaan Boersma.</span>
<span class="comments">;     08-19-2019</span>
<span class="comments">;     Documentation added. Christiaan Boersma.</span>
<span class="comments">;-</span>


<span class="comments">;+</span>
<span class="comments">; Procedure creating a number of random-mixture spectra.</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;   Example</span>
<span class="comments">;-</span>
PRO RANDOM_MIXTURES

  <span class="comments">; test parameters</span>
  n = 1000L

  binsize = 0.0001

  <span class="comments">; spectral parameters</span>
  Ein = 6D * 1.6021765D-12

  FWHM = 15D

  gaussian = 0

  wrange = [2.5D, 20D]

  npoints = 300L

  <span class="comments">; retrieve spectra from the database</span>
  pahdb = OBJ_NEW('AmesPAHdbIDLSuite')

  uids = pahdb->Search("mg=0 fe=0 si=0 o=0 c>20 chx=0 ch2=0", nuids)

  transitions = pahdb->getTransitionsByUID(uids)

  transitions->Cascade,Ein

  spectrum = transitions->Convolve(FWHM=FWHM, Gaussian=gaussian, XRange=1D4/REVERSE(wrange), NPoints=npoints)

  wavelength = 1D4 / spectrum->getGrid()

  spectra = spectrum->get()

  species = pahdb->getSpeciesByUID(uids)

  properties = species->get()

  OBJ_DESTROY,[species, spectrum, transitions, pahdb]

  <span class="comments">; run test</span>
  samples = DBLARR(n, npoints)

  sizeC = DBLARR(n)

  sizeH = DBLARR(n)

  charge = DBLARR(5, n)

  FOR i = 0L, n - 1L DO BEGIN

     PRINT,FORMAT='("' + STRING(13B) + '",I4,$)',i+1L

     abundance = RANDOMU(seed, nuids, /UNIFORM)

     sample = DBLARR(npoints)

     FOR j = 0, nuids - 1 DO BEGIN

        select = WHERE(spectra.data.uid EQ uids[j])

        sample += abundance[j] * spectra.data[select].intensity

        select = WHERE(properties.data.uid EQ uids[j])

        sizeC[i] += abundance[j] * properties.data[select].nC

        sizeH[i] += abundance[j] * properties.data[select].nH

        charge[properties.data[select].charge + 1, i] += abundance[j]

     ENDFOR

     samples[i, *] = sample

  ENDFOR

  matrix = DBLARR(n, n)

  FOR i = 0, n - 1 DO BEGIN

     FOR j = 0, i DO BEGIN

        IF i EQ j THEN BEGIN

           matrix[i,j] = 1D

           CONTINUE

        ENDIF

        matrix[i,j] = CORRELATE(REFORM(samples[i, *]), REFORM(samples[j, *]))

        matrix[j,i] = matrix[i,j]

     ENDFOR

  ENDFOR

  PRINT,FORMAT='(4("' +  + '"),"done!")'

  FOR i = 0, n - 1 DO samples[i, *] /= TOTAL(samples[i, *])

  moments = MOMENT(samples, DIMENSION=1, MAXMOMENT=2)

  h = HISTOGRAM(matrix, LOCATIONS=locations, BINSIZE=binsize)

  dummy = MAX(h, imax)

  select = WHERE(matrix NE 1, nselect)

  avg = MOMENT(matrix[select])

  med = MEDIAN(matrix[select])


  hC = HISTOGRAM(sizeC / nuids, LOCATIONS=locationsC, BINSIZE=0.15)

  dummy = MAX(hc, imaxC)

  avgC = MOMENT(sizeC)


  hH = HISTOGRAM(sizeH / nuids, LOCATIONS=locationsH, BINSIZE=0.1)

  dummy = MAX(hH, imaxH)

  avgH = MOMENT(sizeH)


  hCharge = HISTOGRAM(TOTAL(charge[2:*,*], 1) / TOTAL(charge, 1), LOCATIONS=locationsCharge, BINSIZE=0.005)

  dummy = MAX(hCharge, imaxCharge)

  avgCharge = MOMENT(TOTAL(charge[2:*,*], 1) / TOTAL(charge, 1))


  hDbC = HISTOGRAM(properties.data.nC, LOCATIONS=locationsDbC, BINSIZE=10)

  dummy = MAX(hDbC, imaxDbC)

  avgDbC = MOMENT(properties.data.nC)


  hDbH = HISTOGRAM(properties.data.nH, LOCATIONS=locationsDbH, BINSIZE=1)

  dummy = MAX(hDbH, imaxDbH)

  avgDbH = MOMENT(properties.data.nH)


  <span class="comments">; plot results</span>
  PLOT,[0,1],[0,1],XRANGE=MINMAX(wavelength),/XSTYLE,YRANGE=MINMAX(samples),XTITLE='wavelength [micron]',YTITLE='normalized intensity [erg cm]',/NODATA

  FOR i = 0, n - 1 DO OPLOT,wavelength,samples[i,*],COLOR=14

  FOR i = 0, npoints - 1 DO OPLOT,wavelength[i]*[1,1],SQRT(moments[i,1])*[-1,1]+moments[i,0],COLOR=2,THICK=6

  OPLOT,wavelength,moments[*, 0],THICK=6,COLOR=2

  PLOT,locations,100*h/TOTAL(h),XTITLE='r [Pearson correlation coefficient]',YTITLE='probability [%]',PSYM=10

  OPLOT,locations[imax]*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=4

  OPLOT,avg[0]*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=2

  OPLOT,med*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=3

  OPLOT,avg[0]-0.5*SQRT(avg[1])*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=5

  OPLOT,avg[0]+0.5*SQRT(avg[1])*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=5

  <span class="comments">;OPLOT,avg[0]+0.5*SQRT(avg[1])*[-1,1],5.5*[1,1],LINESTYLE=5,COLOR=5</span>



  XYOUTS,0.2,0.70,STRING(FORMAT='("peak:",X,F-6.4)', locations[imax]),/NORMAL,CHARSIZE=1.75,COLOR=4

  XYOUTS,0.2,0.65,STRING(FORMAT='("&lt;r>:",X,F-6.4)', avg[0]),/NORMAL,CHARSIZE=1.75,COLOR=2

  XYOUTS,0.2,0.60,STRING(FORMAT='("median!Lr!N:",X,F-6.4)', med),/NORMAL,CHARSIZE=1.75,COLOR=3

  XYOUTS,0.2,0.55,STRING(FORMAT='("!Ms!X!Lr!N:",X,F-6.4)', SQRT(avg[1])),/NORMAL,CHARSIZE=1.75,COLOR=5

  XYOUTS,0.2,0.50,STRING(FORMAT='("binsize:",X,F-6.4)', binsize),/NORMAL,CHARSIZE=1.75

  XYOUTS,0.2,0.45,STRING(FORMAT='("n!Lsamples!N:",X,I-4)', n),/NORMAL,CHARSIZE=1.75

  XYOUTS,0.2,0.40,STRING(FORMAT='("fwhm:",X,F-5.2,X,"cm!U-1!N")', fwhm),/NORMAL,CHARSIZE=1.75

  XYOUTS,0.2,0.35,STRING(FORMAT='("E!Lin!N:",X,F-5.2,X,"eV")', Ein / 1.6021765D-12),/NORMAL,CHARSIZE=1.75

  XYOUTS,avg[0],2.5,STRING(FORMAT='(F6.4)',avg[0]),ALIGNMENT=0.5,COLOR=2,CHARSIZE=1

  XYOUTS,locations[imax],3.5,STRING(FORMAT='(F6.4)',locations[imax]),ALIGNMENT=0.5,COLOR=4,CHARSIZE=1

  XYOUTS,med,4.5,STRING(FORMAT='(F6.4)',med),ALIGNMENT=0.5,COLOR=3,CHARSIZE=1

  XYOUTS,avg[0],5.6,STRING(FORMAT='(F6.4)',SQRT(avg[1])),ALIGNMENT=0.5,COLOR=5,CHARSIZE=1


  PLOT,locationsC,100*hC/TOTAL(hC),XTITLE='&lt;n!Lcarbon!N> [#]',YTITLE='probability [%]',PSYM=10

  OPLOT,locationsDbC,100*hDbC/TOTAL(hDbC),PSYM=10,LINESTYLE=5

  OPLOT,locationsC[imaxC]*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=4

  OPLOT,avgC[0]*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=2

  OPLOT,avgC[0]-SQRT(avgC[1])*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=5

  OPLOT,avgC[0]+SQRT(avgC[1])*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=5

  OPLOT,avgC[0]+SQRT(avgC[1])*[-1,1],5.5*[1,1],LINESTYLE=5,COLOR=5


  PLOT,locationsH,100*hH/TOTAL(hH),XTITLE='&lt;n!Lhydrogen!N> [#]',YTITLE='probability [%]',PSYM=10

  OPLOT,locationsDbH,100*hDbC/TOTAL(hDbC),PSYM=10,LINESTYLE=5

  OPLOT,locationsH[imaxH]*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=4

  OPLOT,avgH[0]*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=2

  OPLOT,avgH[0]-SQRT(avgH[1])*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=5

  OPLOT,avgH[0]+SQRT(avgH[1])*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=5

  OPLOT,avgH[0]+SQRT(avgH[1])*[-1,1],10*[1,1],LINESTYLE=5,COLOR=5


  PLOT,locationsCharge,100*hCharge/TOTAL(hCharge),XTITLE='f!Lionized!N [ratio]',YTITLE='probability [%]',PSYM=10

  OPLOT,locationsCharge[imaxCharge]*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=4

  OPLOT,avgCharge[0]*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=2

  OPLOT,avgCharge[0]-SQRT(avgCharge[1])*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=5

  OPLOT,avgCharge[0]+SQRT(avgCharge[1])*[1,1],!Y.CRANGE,LINESTYLE=5,COLOR=5

  OPLOT,avgCharge[0]+SQRT(avgCharge[1])*[-1,1],4*[1,1],LINESTYLE=5,COLOR=5

END
</code>
      </div>
    </div>
  </body>
</html>