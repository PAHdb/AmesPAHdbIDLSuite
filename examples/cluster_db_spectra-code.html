<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.3 on Tue May 16 08:53:06 2023 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>cluster_db_spectra.pro (AmesPAHdbIDLSuite Manual)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="cluster_db_spectra.pro (AmesPAHdbIDLSuite Manual)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="container">
      <div class="content">
	<code class="source"><span class="comments">; docformat = 'rst'</span>

<span class="comments">;+</span>
<span class="comments">;</span>
<span class="comments">; This is an example of clustering (kmeans) PAH absorption spectra,</span>
<span class="comments">; built around the functionality provided by the AmesPAHdbIDLSuite and</span>
<span class="comments">; should help confirm that it has been properly installed. The</span>
<span class="comments">; source code is annotated to guide users and developers in the inner</span>
<span class="comments">; workings of the suite.</span>
<span class="comments">;</span>
<span class="comments">; Updated versions of the NASA Ames PAH IR Spectroscopic Database and</span>
<span class="comments">; more information can be found at: `www.astrochemistry.org/pahdb &lt;https://www.astrochemistry.org/pahdb>`.</span>
<span class="comments">;</span>
<span class="comments">; :Examples:</span>
<span class="comments">;   Call the procedure directly::</span>
<span class="comments">;</span>
<span class="comments">;     IDL> cluster_db_spectra</span>
<span class="comments">;</span>
<span class="comments">; :Author:</span>
<span class="comments">;   Dr. Christiaan Boersma</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;   BSD licensed</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;   Changes::</span>
<span class="comments">;</span>
<span class="comments">;     08-19-2019</span>
<span class="comments">;     Documentation added. Christiaan Boersma.</span>
<span class="comments">;-</span>

<span class="comments">;+</span>
<span class="comments">; Procedure performing the clustering analyzes.</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;   Example</span>
<span class="comments">;-</span>
PRO CLUSTER_DB_SPECTRA

  <span class="comments">; define FWHM, frequency range, number of points and number of clusters to use</span>
  fwhm = 20D

  xrange = 1D4 / [15, 2.5D]

  npoints = 301L

  nclusters = 2

  <span class="comments">; read in the default database defined by the environement variable</span>
  <span class="comments">; !AMESPAHDEFAULTDB or the system variable AMESPAHDEFAULTDB. use the</span>
  <span class="comments">; keyword FILENAME if these have not been set</span>
  pahdb = OBJ_NEW('AmesPAHdbIDLSuite')

  <span class="comments">; retrieve all transitions for all species from the database</span>
  transitions = pahdb->getTransitionsByUID(-1)

  uids = pahdb->Search("c>20", nuids)

  <span class="comments">; convolve spectra</span>
  spectrum = transitions->Convolve(FWHM=fwhm, Xrange=xrange, Npoints=npoints)

  <span class="comments">; obtain the spectrum for use outside object</span>
  spectra = spectrum->Get()

  <span class="comments">; set all integrated intensities to unity</span>
  FOR i = 0, nuids - 1 DO BEGIN

     sel = WHERE(spectra.data.uid EQ uids[i])

     spectra.data[sel].intensity /=  INT_TABULATED(spectra.grid, spectra.data[sel].intensity)

  ENDFOR

  <span class="comments">; clean up objects</span>
  OBJ_DESTROY,[transitions, spectrum, pahdb]

  <span class="comments">; define matrix</span>
  matrix = DBLARR(npoints, nuids, /NOZERO)

  <span class="comments">; fill matrix</span>
  FOR i = 0, nuids - 1 DO BEGIN

     sel = WHERE(spectra.data.uid EQ uids[i])

     matrix[*,i] = spectra.data[sel].intensity

  ENDFOR

  <span class="comments">; perform k-means cluster analysis</span>
  means = CLUST_WTS(matrix, $
                    N_CLUSTERS=nclusters, $
                    /DOUBLE, $
                    N_ITERATIONS=128)

  <span class="comments">; obtain cluster members</span>
  clusters = CLUSTER(matrix, means, N_CLUSTERS=nclusters, /DOUBLE)

  <span class="comments">; plot means</span>
  PLOT,spectra.grid,[0,1],YRANGE=MINMAX(means),XTITLE='frequency [cm!U-1!N]',YTITLE='normalized intensity [km/mol]',/NODATA

  FOR i = 0, nclusters - 1 DO OPLOT,spectra.grid,means[*,i],COLOR=i+2

END
</code>
      </div>
    </div>
  </body>
</html>