<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.3 on Fri Nov 17 14:09:55 2023 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>fit_a_spectrum.pro (AmesPAHdbIDLSuite Manual)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="fit_a_spectrum.pro (AmesPAHdbIDLSuite Manual)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="container">
      <div class="content">
	<code class="source"><span class="comments">; docformat = 'rst'</span>

<span class="comments">;+</span>
<span class="comments">;</span>
<span class="comments">; This is an example of fitting an astronomical spectrum and should</span>
<span class="comments">; confirm that the AmesPAHdbIDLSuite has been correctly installed. The</span>
<span class="comments">; source code is annotated to guide users and developers in the inner</span>
<span class="comments">; workings of the suite.</span>
<span class="comments">;</span>
<span class="comments">; Updated versions of the NASA Ames PAH IR Spectroscopic Database and</span>
<span class="comments">; more information can be found at: `www.astrochemistry.org/pahdb &lt;https://www.astrochemistry.org/pahdb>`.</span>
<span class="comments">;</span>
<span class="comments">; :Examples:</span>
<span class="comments">;   Call the procedure directly::</span>
<span class="comments">;</span>
<span class="comments">;     IDL> fit_a_spectrum</span>
<span class="comments">;</span>
<span class="comments">; :Author:</span>
<span class="comments">;   Dr. Christiaan Boersma</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;   BSD licensed</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;   Changes::</span>
<span class="comments">;</span>
<span class="comments">;     05-03-2022</span>
<span class="comments">;     Add plotting size distribution. Christiaan Boersma.</span>
<span class="comments">;     08-19-2019</span>
<span class="comments">;     Documentation added. Christiaan Boersma.</span>
<span class="comments">;-</span>

<span class="comments">;+</span>
<span class="comments">; Procedure demonstrating fitting an astronomical spectrum using the</span>
<span class="comments">; AmesPAHdbIDLSuite.</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;   Example</span>
<span class="comments">;-</span>
PRO FIT_A_SPECTRUM

  <span class="comments">; the Spitzer IRS/SL 10 - 15 micron spectrum of NGC7023</span>
  file = 'ngc7023.dat'

  <span class="comments">; read observations into AmesPAHdbIDLSuite_Observation</span>
  observation = OBJ_NEW('AmesPAHdbIDLSuite_Observation', $
                        file, $
                        Units=AmesPAHdbIDLSuite_CREATE_OBSERVATION_UNITS_S(AUNIT=3, OUNIT=1))

  <span class="comments">; turn wavelength into frequency</span>
  observation->AbscissaUnitsTo,1

  <span class="comments">; rebin to uniform frequency grid</span>
  <span class="comments">;observation->Rebin,5D,/Uniform</span>

  <span class="comments">; read in the default database defined by the environement variable</span>
  <span class="comments">; !AMESPAHDEFAULTDB or the system variable AMESPAHDEFAULTDB. use</span>
  <span class="comments">; the keyword FILENAME if these have not been set</span>
  pahdb = OBJ_NEW('AmesPAHdbIDLSuite')

  <span class="comments">; retrieve the transitions from the database for a subset of PAHs</span>
  transitions = pahdb->getTransitionsByUID( $
                pahdb->Search("magnesium=0 oxygen=0 iron=0 silicium=0 chx=0 ch2=0 c>20 h>0"))

  <span class="comments">; shift data 15 wavenumber to the red</span>
  transitions->Shift,-15D

  <span class="comments">; convolve the transitions into a spectrum</span>
  spectrum = transitions->Convolve(Grid=observation->getGrid(), $
                                   FWHM=15D, $
                                   /Gaussian)

  <span class="comments">; fit the spectrum</span>
  fit = spectrum->Fit(observation)

  <span class="comments">; clean up spectrum</span>
  obj_destroy,[spectrum]

  <span class="comments">; display fit and breakdown</span>
  fit->Plot,/Wavelength

  key = ''
  IF !D.NAME EQ 'X' THEN READ,key,PROMPT="Press &lt;enter> to continue..."

  fit->Plot,/Wavelength,/Residual

  IF !D.NAME EQ 'X' THEN READ,key,PROMPT="Press &lt;enter> to continue..."

  fit->Plot,/Wavelength,/Size

  IF !D.NAME EQ 'X' THEN READ,key,PROMPT="Press &lt;enter> to continue..."

  fit->Plot,/Wavelength,/Charge

  IF !D.NAME EQ 'X' THEN READ,key,PROMPT="Press &lt;enter> to continue..."

  fit->Plot,/Wavelength,/Composition

  IF !D.NAME EQ 'X' THEN READ,key,PROMPT="Press &lt;enter> to continue..."

  fit->Plot,/DistributionSize,NBins=10L,Min=20,Max=200

  IF !D.NAME EQ 'X' THEN READ,key,PROMPT="Press &lt;enter> to continue..."

  <span class="comments">; predict 3 - 20 um spectrum</span>
  transitions->Intersect, $
          fit->getUIDs()

  xrange = 1D4 / [20D, 3D]

  spectrum = transitions->Convolve(FWHM=15D, $
                                   /Gaussian, $
                                   XRange=xrange)

  coadded = spectrum->Coadd(Weights=fit->getWeights())

  coadded->Plot

  <span class="comments">; clean up objects</span>
  OBJ_DESTROY,[coadded, spectrum, fit, transitions, pahdb, observation]

END
</code>
      </div>
    </div>
  </body>
</html>