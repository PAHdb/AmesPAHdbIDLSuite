<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.3 on Fri Apr  7 10:08:49 2023 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>mc_fit_a_spectrum.pro (AmesPAHdbIDLSuite Manual)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="mc_fit_a_spectrum.pro (AmesPAHdbIDLSuite Manual)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="container">
      <div class="content">
	<code class="source"><span class="comments">; docformat = 'rst'</span>

<span class="comments">;+</span>
<span class="comments">;</span>
<span class="comments">; This is an example of fitting an astronomical spectrum using a Monte Carlo</span>
<span class="comments">; approach and should confirm that the AmesPAHdbIDLSuite has been correctly</span>
<span class="comments">; installed. The source code is annotated to guide users and developers in</span>
<span class="comments">; the inner workings of the suite.</span>
<span class="comments">;</span>
<span class="comments">; Updated versions of the NASA Ames PAH IR Spectroscopic Database and</span>
<span class="comments">; more information can be found at: `www.astrochemistry.org/pahdb &lt;https://www.astrochemistry.org/pahdb>`.</span>
<span class="comments">;</span>
<span class="comments">; :Examples:</span>
<span class="comments">;   Call the procedure directly::</span>
<span class="comments">;</span>
<span class="comments">;     IDL> mc_fit_a_spectrum</span>
<span class="comments">;</span>
<span class="comments">; :Author:</span>
<span class="comments">;   Dr. Christiaan Boersma</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;   BSD licensed</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;   Changes::</span>
<span class="comments">;</span>
<span class="comments">;     05-03-2022</span>
<span class="comments">;     Add plotting size distribution. Christiaan Boersma.</span>
<span class="comments">;     04-28-2022</span>
<span class="comments">;     Adapt for piecewise errors. Christiaan Boersma.</span>
<span class="comments">;     04-27-2022</span>
<span class="comments">;     Use MCFit instead of Fit. Christiaan Boersma.</span>
<span class="comments">;     07-06-2021</span>
<span class="comments">;     Cleaned up progress bar. Christiaan Boersma.</span>
<span class="comments">;     04-30-2021</span>
<span class="comments">;     First version. Christiaan Boersma.</span>
<span class="comments">;-</span>

<span class="comments">;+</span>
<span class="comments">; Procedure demonstrating fitting an astronomical spectrum using the</span>
<span class="comments">; AmesPAHdbIDLSuite and establishing uncertainties using a Monte-Carlo</span>
<span class="comments">; approach.</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;   Example</span>
<span class="comments">;-</span>
PRO MC_FIT_A_SPECTRUM

  <span class="comments">; the Spitzer IRS/SL 10 - 15 micron spectrum of NGC7023</span>
  file = 'ngc7023.dat'

  <span class="comments">; read observations into AmesPAHdbIDLSuite_Observation</span>
  observation = OBJ_NEW('AmesPAHdbIDLSuite_Observation', $
                        file, $
                        Units=AmesPAHdbIDLSuite_CREATE_OBSERVATION_UNITS_S(AUNIT=3, OUNIT=1))

  <span class="comments">; turn wavelength into frequency</span>
  observation->AbscissaUnitsTo,1

  <span class="comments">; read in the default database defined by the environement variable</span>
  <span class="comments">; !AMESPAHDEFAULTDB or the system variable AMESPAHDEFAULTDB. use</span>
  <span class="comments">; the keyword FILENAME if these have not been set</span>
  pahdb = OBJ_NEW('AmesPAHdbIDLSuite')

  <span class="comments">; search for the UIDs for a subset of PAHs</span>
  uids = pahdb->Search("magnesium=0 oxygen=0 iron=0 silicium=0 chx=0 ch2=0 c>20 h>0")

  <span class="comments">; put back fullerenes, which have h=0</span>
  fullerenes = [717, 720, 723, 735, 736, 737]

  uids = [uids, fullerenes]

  <span class="comments">; retrieve the transitions for the subset of PAHs</span>
  transitions = pahdb->getTransitionsByUID(uids)

  <span class="comments">; apply full temperature cascade emission model with an 8 eV photon</span>
  transitions->Cascade,8D*1.602D-12

  <span class="comments">; shift data 15 wavenumber to the red</span>
  transitions->Shift,-15D

  <span class="comments">; convolve the transitions into a spectrum</span>
  spectrum = transitions->Convolve(Grid=observation->getGrid(), $
                                   FWHM=15D, $
                                   /Gaussian)

  <span class="comments">; clean up transitions</span>
  OBJ_DESTROY,[transitions]

  <span class="comments">; fit the spectrum using Monte Carlo approach</span>
  mcfit = spectrum->MCFit(observation, 1024)

  <span class="comments">; get observations struct</span>
  observation_s = observation.Get()

  <span class="comments">; clean up observation</span>
  OBJ_DESTROY,[observation]

  <span class="comments">; clean up</span>
  OBJ_DESTROY,[spectrum]

  <span class="comments">; print results</span>
  mcbd = mcfit->GetBreakdown()
  
  tags = TAG_NAMES(mcbd)

  ntags = N_TAGS(mcbd)

  PRINT,FORMAT='(A8,X,A6,X,A6)','','MEAN','STDEV'
  FOR i = 0, ntags - 1 DO $
    PRINT,FORMAT='(A8,X,F6.2,X,F6.3)',tags[i],mcbd.(i)[0],SQRT(mcbd.(i)[1])
  mcerr = mcfit->GetError()

  tags = TAG_NAMES(mcerr)

  ntags = N_TAGS(mcerr)

  FOR i = 0, ntags - 1 DO $
    PRINT,FORMAT='(A8,X,F6.2,X,F6.3)',tags[i],mcerr.(i)[0],mcerr.(i)[1]

  mcfit->Plot,/Wavelength

  key = ''
  IF !D.NAME EQ 'X' THEN READ,key,PROMPT="Press &lt;enter> to continue..."

  mcfit->Plot,/Wavelength,/Size

  IF !D.NAME EQ 'X' THEN READ,key,PROMPT="Press &lt;enter> to continue..."

  mcfit->Plot,/Wavelength,/Charge

  IF !D.NAME EQ 'X' THEN READ,key,PROMPT="Press &lt;enter> to continue..."

  mcfit->Plot,/Wavelength,/Composition

  IF !D.NAME EQ 'X' THEN READ,key,PROMPT="Press &lt;enter> to continue..."

  mcfit->Plot,/DistributionSize,NBins=10L,Min=20,Max=200

  OBJ_DESTROY,[mcfit, pahdb]

END
</code>
      </div>
    </div>
  </body>
</html>